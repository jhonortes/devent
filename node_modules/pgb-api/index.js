module.exports=function(e){var t={};function r(n){if(t[n])return t[n].exports;var s=t[n]={i:n,l:!1,exports:{}};return e[n].call(s.exports,s,s.exports,r),s.l=!0,s.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)r.d(n,s,function(t){return e[t]}.bind(null,s));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=5)}([function(e,t,r){const n=r(1),s=r(2),o=r(3).Writable;e.exports={merge:function(){const e=(t,r)=>{for(let n in t)t[n]&&t[n].constructor===Object?(r[n]=r[n]||{},r[n]=e(t[n],r[n])):r[n]=t[n];return r};return Array.from(arguments).reduce((t,r)=>e(r,t),{})},mkdirp:function(e){e=e||"";let t=s.resolve(e).split(s.sep);for(let e=1;e<t.length;e++){let r=s.join(t.slice(0,e+1).join(s.sep)+s.sep);n.existsSync(r)||n.mkdirSync(r)}},TextStream:class extends o{constructor(){super(),this._chunks=[]}_write(e,t,r){this._chunks.push(e),r()}toString(){return this._chunks.join("")}},getPath:e=>{let t,r;return e.endsWith(s.sep)||n.existsSync(e)&&n.statSync(e).isDirectory()?r=e:(r=s.dirname(e),t=s.basename(e)),{filename:t,directory:r}}}},function(e,t){e.exports=require("fs")},function(e,t){e.exports=require("path")},function(e,t){e.exports=require("stream")},function(e,t){e.exports=require("url")},function(e,t,r){"use strict";const n=r(0).merge,s=r(0).getPath,o=r(0).mkdirp,a=r(6),i=r(8),p=r(1),u=r(2),l=r(11),d=r(4).parse,h="https://build.phonegap.com/api/v1";e.exports=(e=>new class{constructor(e){this.defaults=n(e)}_get(e,t){return a.get(h+e,n(this.defaults,t))}_post(e,t){return a.post(h+e,n(this.defaults,t))}_put(e,t){return a.put(h+e,n(this.defaults,t))}_del(e,t){return a.del(h+e,n(this.defaults,t))}me(){return this._get("/me")}getToken(){return this._post("/token")}getApps(){return this._get("/apps")}getStatus(e){return this._get(`/apps/${e}/status`)}getApp(e){return this._get(`/apps/${e}`)}getAppLog(e,t){return this._get(`/apps/${e}/logs/${t}/build`)}_app(e,t){return e?this._put(`/apps/${e}`,{data:t}):this._post("/apps",{data:t})}deleteApp(e){return this._del(`/apps/${e}`)}downloadApp(e,t,r){return this._get(`/apps/${e}/${t}`,{save:r})}buildApp(e){let t=[].slice.call(arguments).slice(1);return t=[].concat.apply([],t).join(","),this._post(`/apps/${e}/build`,{data:{platforms:t}})}addCollaborator(e,t,r){return this._post(`/apps/${e}/collaborators`,{data:{email:t,role:r}})}updateCollaborator(e,t,r){return this._put(`/apps/${e}/collaborators/${t}`,{data:{role:r}})}deleteCollaborator(e,t){return this._del(`/apps/${e}/collaborators/${t}`)}getKeys(e){return this._get(`/keys/${e||""}/`)}getKey(e,t){return this._get(`/keys/${e}/${t}`)}addKey(e,t){return this._post(`/keys/${e}`,{data:t})}updateKey(e,t,r){return this._put(`/keys/${e}/${t}`,{data:r})}deleteKey(e,t){return this._del(`/keys/${e}/${t}`)}currentSupport(){return this._get("/current_support")}isRepo(e){try{return e.toString().match(/^[a-z0-9_-][a-z0-9_.-]*\/[a-z0-9_.-]+(#[a-z0-9_.-]*)?$/i)||d(e).hostname}catch(e){return!1}}addApp(e,t){return this.updateApp(null,e,t)}updateApp(e,t,r){r||"string"==typeof t||(r=t,t=null);let n=p.existsSync(t);return t?n&&p.statSync(t).isDirectory()?this.addAppFromDir(e,t,r):this.isRepo(t)?this.addAppfromRepo(e,t,r):this.addAppFromFile(e,t,r):this._app(e,r)}addAppFromDir(e,t,r){return new Promise((n,a)=>{let d=!1,h=r.zip;delete r.zip;let c=r.ignore||[];delete r.ignore,h||(h=u.join(l.tmpdir(),"pgb-"+Math.random().toString(32).slice(2)+".zip"),d=!0);let f=s(h);f.filename=f.filename||"app.zip",o(f.directory),h=u.join(f.directory,f.filename);const m=(e,t)=>{this.defaults.events&&this.defaults.events.emit&&this.defaults.events.emit(e,t)},y=()=>{d&&p.existsSync(h)&&p.statSync(h).isFile()&&(p.unlinkSync(h),m("debug",`archive deleted ${h}`))};m("debug",`archiving ${t} to ${h}`),i(t,h,this.defaults.events,c).then(()=>this.addAppFromFile(e,h,r)).then(e=>{y(),n(e)}).catch(e=>{y(),a(e)})})}addAppfromRepo(e,t,r){return this._app(e,n(r,{repo:t}))}addAppFromFile(e,t,r){return new Promise((s,o)=>{let a=p.createReadStream(t);a.once("error",o),this._app(e,n(r,{file:a})).then(s,o)})}pullApp(e,t){return this._app(e,n(t,{pull:!0}))}lockKey(e,t){return this.updateKey(e,t,{lock:!0})}addIOSKey(e,t,r,s){return new Promise((o,a)=>{let i=p.createReadStream(t);i.once("error",a);let u=p.createReadStream(r);return u.once("error",a),this.addKey("ios",n({title:e,profile:i,cert:u},s)).then(o,a)})}addWindowsKey(e,t,r){return new Promise((s,o)=>{let a=p.createReadStream(t);return a.once("error",o),this.addKey("windows",n({title:e,keystore:a},r)).then(s,o)})}addAndroidKey(e,t,r,s){return new Promise((o,a)=>{let i=p.createReadStream(r);return i.once("error",a),this.addKey("android",n({title:e,keystore:i,alias:t},s)).then(o,a)})}addWinphoneKey(e,t,r){return this.addKey("winphone",n({title:e,publisher_id:t},r))}unlockIOSKey(e,t){return this.updateKey("ios",e,{password:t})}unlockAndroidKey(e,t,r){return this.updateKey("android",e,{keystore_pw:t,key_pw:r})}unlockWindowsKey(e,t){return this.updateKey("windows",e,{password:t})}hasAuth(){return!(!this.defaults.headers||!this.defaults.headers.Authorization)}clearAuth(){this.hasAuth()&&delete this.defaults.headers.Authorization}addAuth(e,t){if(this.defaults.headers=this.defaults.headers||{},e&&t){let r=`${e}:${t}`;r=Buffer.from!==Uint8Array.from?Buffer.from(r):new Buffer(r),this.defaults.headers.Authorization=`Basic ${r.toString("base64")}`}else e&&(this.defaults.headers.Authorization=`token ${e}`);return this}}(e))},function(e,t,r){const n=r(0).merge,s=r(0).mkdirp,o=r(0).TextStream,a=r(0).getPath,i=r(4),p=r(1),u=r(2),l=r(3).Stream,d=r(7),h={headers:{"User-Agent":`pgb-api/1.1.1 node/${process.version} (${process.platform})`}},c=(e,t,r)=>{e.opts.events&&e.opts.events.emit&&e.opts.events.emit(t,r)},f=(e,t)=>(t=t||{},new Promise((l,g)=>{let _=0,$={},b=i.parse(e);$.opts=n(h,b,t),m($),c($,"api/headers",$.opts.headers),c($,"debug",`${$.opts.method||"GET"} ${e}`),$.req=d.request($.opts,n=>{$.response=n;let d=Number.parseInt(n.headers["content-length"])||null,h=Math.trunc(n.statusCode/100);if(3===h&&"location"in n.headers){let r=i.parse(n.headers.location);return t.headers&&$.opts.hostname!==r.hostname&&delete t.headers.Authorization,r=i.resolve(e,r.href),c($,"debug",`${$.req.method} ${e} -> ${n.statusCode} ${r}`),l(f(r,t))}if($.opts.save&&2===h)if($.opts.save instanceof r(3).Writable)$.output=$.opts.save;else{let e=a($.opts.save);e.filename=decodeURI(e.filename||u.basename($.opts.pathname)||"app.download"),$.output=u.join(e.directory,e.filename);try{s(e.directory),p.closeSync(p.openSync($.output,"w")),$.path=u.resolve($.output)}catch(e){return g(e)}c($,"debug",`saving to ${$.path}`),$.output=p.createWriteStream($.output)}c($,"api/connect",{statusCode:n.statusCode,size:d,headers:n.headers,path:$.path,url:e,method:$.req.method}),c($,"debug",`${$.req.method} ${e} -> ${n.statusCode}`),$.output=$.output||new o,$.output.once("error",g),n.pipe($.output),n.on("data",e=>{_+=e.length,c($,"api/read",{size:d,pos:_,delta:e.length})}),n.once("end",()=>{let e=(e=>{let t,r;if(e.output.constructor===o){t=e.output.toString();try{r=JSON.parse(t)}catch(e){}}return e.path||r||t})($);if(2===h)l(e);else{let t=new Error(e.error||e);t.statusCode=n.statusCode,g(t)}})}),$.req.once("error",g),y($)})),m=e=>{if(e._payload=[],e._contentLength=0,null==e.opts.data)return;for(let t in e.opts.data){let r=e.opts.data[t];if(e._payload.push("------pgbapi\r\n"),r instanceof l){let n=u.basename(r.path);e._payload.push(`Content-Disposition: form-data; name="${t}"; filename="${n.replace('"','\\"')}"\r\n`),e._payload.push("Content-Type: application/octet-stream\r\n\r\n"),e._payload.push(r),e._payload.push("\r\n")}else e._payload.push(`Content-Disposition: form-data; name="${t}";\r\n\r\n`),r&&"Object"===r.constructor.name&&(r=JSON.stringify(r)),e._payload.push(`${r}\r\n`)}e._payload.push("------pgbapi--\r\n");for(let t of e._payload)e._contentLength+=t.length||p.statSync(t.path).size;e.opts.headers["Content-Length"]=e._contentLength,e.opts.headers["Content-Type"]="multipart/form-data; boundary=----pgbapi"},y=e=>{if(0===e._payload.length)return e.req.end();let t=0;let r=e._payload.slice(0),n=()=>{((r,n)=>{r instanceof l?(r.on("data",r=>{t+=r.length,c(e,"api/write",{size:e._contentLength,pos:t,delta:r.length})}),r.once("end",n),r.pipe(e.req,{end:!1})):(t+=r.length,e.req.write(r),c(e,"api/write",{size:e._contentLength,pos:t,delta:r.length}),n())})(r.shift(),()=>0===r.length?e.req.end():n())};n()};e.exports={post:(e,t)=>f(e,n(t,{method:"POST"})),put:(e,t)=>f(e,n(t,{method:"PUT"})),del:(e,t)=>f(e,n(t,{method:"DELETE"})),get:f}},function(e,t){e.exports=require("https")},function(e,t,r){const n=r(1),s=r(9),o=r(2),a=r(10).glob;e.exports=((e,t,r,i)=>new Promise((p,u)=>{let l=a(e,i),d=n.createWriteStream(t),h=new s.ZipFile,c="",f=0,m=[0],y=0,g=0;const _=(e,t)=>{r&&r.emit(e,t)};_("zip/files",l);for(let t of l.list){let r=o.resolve(o.join(e,t.path));n.statSync(r).isDirectory()?(h.addEmptyDirectory(t.path),y+=46+t.path.length+1):(h.addFile(r,t.path),y+=46+t.path.length),m.push(y+=t.size)}d.on("error",u),h.outputStream.on("error",u),h.outputStream.pipe(d).once("close",()=>{_("zip/write",{size:y,file:c,pos:y,delta:m[m.length-1]-g}),_("zip/end",!0),p()}),h.outputStream.on("data",e=>{for(let e=f;e<h.entries.length;e++){let t=h.entries[e];if(2===t.state){c=t.utf8FileName.toString(),f=e;break}}_("zip/write",{size:y,file:c,pos:m[f],delta:m[f]-g}),g=m[f]}),h.end()}))},function(e,t){e.exports=require("yazl")},function(e,t,r){const n=r(1),s=r(2),o=e=>{if(null==e||"#"===e[0]||""===e.trim())return null;let t=0===e.indexOf("!"),r=!1;return e.endsWith("/")&&(e=e.slice(0,-1),r=!0),(t||"/"===e[0])&&(e=e.slice(1)),-1===(e=e.replace(/[.+^${}()|[\]\\]/g,"\\$&").replace(/\?/g,".").replace(/\*\*\//g,"^e^").replace(/\*\*/g,"^e^").replace(/\*/g,"[^/]+").replace(/\^e\^/g,".*")).indexOf("/")&&(e+="/?"),{dir:r,not:t,regex:new RegExp(`^${e}$`)}},a=(e,t,r)=>{let n=!1;e=e.split(s.sep).join("/");for(let s of r)if(null!=s&&(!s.dir||t)&&s.regex.test(e)){if(s.dir&&t)return!s.not;n=!s.not}return n};e.exports={glob:(e,t)=>{let r=[],i=[],p=(t||[]).map(o),u=t=>{n.readdirSync(t).forEach(o=>{let l=s.join(t,o),d=s.relative(e,l);if(!o.startsWith(".")||o.match(/^\.pgb/))try{let e=n.statSync(l);n.closeSync(n.openSync(l,"r"));let t=a(d,e.isDirectory(),p);e.isDirectory()?t?i.push(`${d}${s.sep} [IGNORED]`):(r.push({path:d,size:0}),u(l)):(t?i.push(`${d} [IGNORED]`):r.push({path:d,size:e.size}),r.push())}catch(e){i.push(`${d} [${e.code}]`)}else i.push(`${d} [HIDDEN]`)})};return u(e),{list:r,skipped:i}},toGlobRegex:o,filter:a}},function(e,t){e.exports=require("os")}]);